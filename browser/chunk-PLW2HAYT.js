import{b as j}from"./chunk-W4VTQAXI.js";import{a as D,b as f,c as M,d as V,f as z,g as G,h as P,i as R,j as A,k as H,l as B}from"./chunk-2F3MK2WT.js";import{f as v,g as J}from"./chunk-PKG5FSFZ.js";import{a as N,b as U,j as O}from"./chunk-I6E5G4JW.js";import{l as T,n as q}from"./chunk-GTNUZGCN.js";import{Ab as w,B as S,Eb as o,Fb as i,Gb as c,J as k,Lb as I,Mb as _,R as y,Sb as m,U as x,Wa as a,Y as C,ca as l,db as L,n as h,na as E,q as b,rb as F,ub as g,wb as s}from"./chunk-GJZEK5VD.js";var K=(()=>{class e{constructor(){this.http=l(U),this.urlService=l(O),this.userService=l(J),this.router=l(j),this.dialogService=l(v)}login(r,n){let t=new FormData;return t.append("username",r),t.append("password",n),this.http.post(this.urlService.URLS.LOGIN,t).pipe(y(p=>p.access_token?(localStorage.setItem("access_token",p.access_token),this.userService.getCurrentUser().pipe(x(u=>this.userService.updateCurrentUser(u)),x(()=>this.router.navigate(["/chat-assistant"])),b(()=>{}))):h(()=>new Error("Invalid server response"))),S(this.handleLoginError.bind(this)))}handleLoginError(r){let n="Login Error",t="An error occurred during login.";return r instanceof N?r.status===401?t="Invalid username or password.":r.status===0?t="Unable to connect to server. Please check your internet connection.":r.error?.detail&&(t=r.error.detail):t=r.message,this.dialogService.error(n,t).pipe(y(()=>h(()=>r)))}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275prov=C({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();function W(e,d){e&1&&(o(0,"span"),m(1,"Username is required"),i())}function X(e,d){e&1&&(o(0,"span"),m(1,"Username must be at least 3 characters"),i())}function Y(e,d){if(e&1&&(o(0,"div",22),g(1,W,2,0,"span",23)(2,X,2,0,"span",23),i()),e&2){let r,n,t=_();a(),s("ngIf",(r=t.loginForm.get("username"))==null||r.errors==null?null:r.errors.required),a(),s("ngIf",(n=t.loginForm.get("username"))==null||n.errors==null?null:n.errors.minlength)}}function Z(e,d){e&1&&(o(0,"span"),m(1,"Password is required"),i())}function $(e,d){e&1&&(o(0,"span"),m(1,"Password must be at least 6 characters"),i())}function ee(e,d){if(e&1&&(o(0,"div",22),g(1,Z,2,0,"span",23)(2,$,2,0,"span",23),i()),e&2){let r,n,t=_();a(),s("ngIf",(r=t.loginForm.get("password"))==null||r.errors==null?null:r.errors.required),a(),s("ngIf",(n=t.loginForm.get("password"))==null||n.errors==null?null:n.errors.minlength)}}function te(e,d){e&1&&(o(0,"span",24),E(),o(1,"svg",25),c(2,"circle",26)(3,"path",27),i()())}function re(e,d){e&1&&(o(0,"span"),m(1,"Sign in"),i())}function ie(e,d){e&1&&(o(0,"span"),m(1,"Signing in..."),i())}var be=(()=>{class e{constructor(){this.fb=l(A),this.dialogService=l(v),this.loginService=l(K),this.isLoading=F(!1)}ngOnInit(){this.initializeForm()}initializeForm(){this.loginForm=this.fb.group({username:["",[f.required,f.minLength(3)]],password:["",[f.required,f.minLength(6)]]})}onSubmit(){if(this.loginForm.invalid){this.dialogService.error("Validation Error","Please fill in all fields correctly").subscribe();return}this.isLoading.set(!0);let{username:r,password:n}=this.loginForm.value;this.loginService.login(r,n).pipe(k(()=>this.isLoading.set(!1))).subscribe()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=L({type:e,selectors:[["app-login"]],decls:33,vars:7,consts:[[1,"min-h-screen","decorative-pattern","flex","items-center","justify-center","py-12","px-4","sm:px-6","lg:px-8"],[1,"max-w-md","w-full","space-y-8","bg-white","dark:bg-dark-surface","p-8","rounded-lg","shadow-xl","dark:shadow-gray-900/30","relative","z-10"],[1,"text-center"],[1,"flex","justify-center","mb-4"],["src","assets/qulogo.png","alt","School AI Logo",1,"h-16","w-auto","transition-transform","duration-300","hover:scale-105"],[1,"mt-8","space-y-6",3,"ngSubmit","formGroup"],[1,"space-y-2"],["for","username",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],[1,"relative"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],[1,"text-gray-500","dark:text-gray-400"],[1,"mdi","mdi-account","text-lg"],["id","username","formControlName","username","type","text","required","","placeholder","Enter your username",1,"appearance-none","block","w-full","pl-10","pr-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","placeholder-gray-400","dark:placeholder-gray-500","focus:outline-none","focus:ring-primary","dark:focus:ring-accent-yellow","focus:border-primary","dark:focus:border-accent-yellow","text-gray-900","dark:text-white","bg-white","dark:bg-dark-surface","sm:text-sm"],["class","text-xs text-red-500 mt-1",4,"ngIf"],["for","password",1,"block","text-sm","font-medium","text-gray-700","dark:text-gray-300"],[1,"mdi","mdi-lock","text-lg"],["id","password","formControlName","password","type","password","required","","placeholder","Enter your password",1,"appearance-none","block","w-full","pl-10","pr-3","py-2","border","border-gray-300","dark:border-gray-600","rounded-md","shadow-sm","placeholder-gray-400","dark:placeholder-gray-500","focus:outline-none","focus:ring-primary","dark:focus:ring-accent-yellow","focus:border-primary","dark:focus:border-accent-yellow","text-gray-900","dark:text-white","bg-white","dark:bg-dark-surface","sm:text-sm"],[1,"flex","items-center","justify-end"],[1,"text-sm"],["href","#",1,"font-medium","text-primary","hover:text-secondary","dark:text-accent-yellow","hover:text-secondary/80","dark:hover:text-accent-yellow/80","transition-colors","duration-200"],["type","submit",1,"group","relative","w-full","flex","justify-center","py-2","px-4","border","border-transparent","text-sm","font-medium","rounded-md","text-white","bg-primary","hover:bg-secondary","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-primary","dark:focus:ring-accent-yellow","dark:focus:ring-offset-dark-surface","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","duration-200",3,"disabled"],["class","absolute left-0 inset-y-0 flex items-center pl-3",4,"ngIf"],[1,"text-xs","text-red-500","mt-1"],[4,"ngIf"],[1,"absolute","left-0","inset-y-0","flex","items-center","pl-3"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-5","w-5","text-white"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(n,t){if(n&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),c(4,"img",4),i()(),o(5,"form",5),I("ngSubmit",function(){return t.onSubmit()}),o(6,"div",6)(7,"label",7),m(8," Username "),i(),o(9,"div",8)(10,"div",9)(11,"span",10),c(12,"i",11),i()(),c(13,"input",12),i(),g(14,Y,3,2,"div",13),i(),o(15,"div",6)(16,"label",14),m(17," Password "),i(),o(18,"div",8)(19,"div",9)(20,"span",10),c(21,"i",15),i()(),c(22,"input",16),i(),g(23,ee,3,2,"div",13),i(),o(24,"div",17)(25,"div",18)(26,"a",19),m(27," Forgot your password? "),i()()(),o(28,"div")(29,"button",20),g(30,te,4,0,"span",21)(31,re,2,0,"span")(32,ie,2,0,"span"),i()()()()()),n&2){let p,u;a(5),s("formGroup",t.loginForm),a(9),s("ngIf",((p=t.loginForm.get("username"))==null?null:p.touched)&&((p=t.loginForm.get("username"))==null?null:p.invalid)),a(9),s("ngIf",((u=t.loginForm.get("password"))==null?null:u.touched)&&((u=t.loginForm.get("password"))==null?null:u.invalid)),a(6),s("disabled",t.isLoading()||t.loginForm.invalid),a(),s("ngIf",t.isLoading()),a(),w(t.isLoading()?-1:31),a(),w(t.isLoading()?32:-1)}},dependencies:[H,z,D,M,V,R,q,T,B,G,P],encapsulation:2})}}return e})();export{be as LoginComponent};
